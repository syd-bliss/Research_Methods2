---
title: "R_Markdown"
author: "Sydney_Bliss"
date: '2018-01-31'
output: html_document
---
 
#####Swallow Breeding Performance & Phenology in the Maritimes  

**Background**
Aerial insectivore populations, including Tree (Tachycineta bicolor) and Barn (Hirundo rustica) Swallows, have experienced precipitous declines since the 1970s in North America. There are indications that a concurrent decline in insects, coupled with earlier spring emergence driven by climate change, may be occurring. Such a change in insects would likely alter the breeding phenology and performance of swallows and may be linked to species-wide population declines. In the absence of insect abundance data, winter weather data, which influences insect abundance, can instead be used to examine relationships between food availability, and swallow breeding phenology and performance.

**Biological Questions:**   
Q1 - Has swallow breeding phenology (clutch initiation date) changed from 1962-2016?  
Q2 - Has swallow breeding performance (chick survival) changed from 1962-2016?   
Q3 - Is breeding phenology affected by climate?   
Q4 - Is breeding performance affected by climate?  

  
**STEP 1: IMPORT PACKAGES & DATA**  

Load required packages, import data set and save it to an object:
```{r chunk_namee, results='hide'}
library(tidyverse) 
rm(list = ls())
swallows.df <- read_csv("swallows.csv")
```

Make sure R is reading the data correctly:
```{r}
problems(swallows.df) 
```
**STEP 2: TIDY THE DATA**   

Drop unnecessary columns using select():
```{r}
swallows.df.2 <- select(swallows.df, Species, NestID, Province, Site, Latitude, Longitude, Year, CID, HD, CS, BS, SD12, minFt, minJFt, medJFt, medJp, meanMAp)
```

Create three time bins, (1) 1960-1972, (2) 1973-2005, (3) 2006-2016 to aid interpretation of changes over time, using mutate():
```{r}
swallows.df.3 <- swallows.df.2 %>% mutate(Yr = cut(Year, breaks = c(1959, 1972, 2005, 2016), labels =  c("1960-1972", "1973-2005", "2006-2016")))
```

Create survival rate (Surv.Rate) by dividing the SD12 variable (# of chicks that survived to day 12) by clutch size (CS), using mutate():
```{r}
swallows.df.4 <- swallows.df.3 %>% mutate(Surv.Rate = SD12 / CS)
```

Thereâ€™s an outlier in a Tree Swallow CID record (value = 96, or Aug 4) which is biologically unlikely. Probably due to a recording error. Drop outlier:
```{r}
swallows.df.5 <- filter(swallows.df.4, CID < 96) 
```

Make sure the data look ok after all these changes:
```{r}
summary(swallows.df.5)
str(swallows.df.5)
```

Make a tibble for each species so they can be examined separately:
```{r}
TRES.df <- filter(swallows.df.3, Species == "TRES")  # tree swallows
BARS.df <- filter(swallows.df.3, Species == "BARS")  # barn swallows
```
   
**STEP 3: VISUALIZE DATA for each biological question**

Histogram to see how many records exist for each species. Result looks unbalanced, which is likely due to varying volunteer effort. Far more Tree Swallows were sampled than Barn Swallows, and most data were collected after 2010 in both species.
```{r}
ggplot(swallows.df.5, aes(x = Year)) + 
  geom_histogram(bins = 60) + 
  facet_grid(. ~ Species) + 
  xlab("Year") + 
  ylab("Count") +
  labs(title = "Number of Nests Sampled, Tree and Barn Swallows")
```
   
**Q1 - Changes in breeding phenology. Look at clutch initiation date (CID) in both species over time.**

Scatterplot to see spread of the data. Looks like Barn Swallows start laying eggs later in the spring and continue later into the summer than Tree Swallows, likely because Barn Swallows are double-brooded. Tree Swallows start laying earlier and have a more restricted laying range.
```{r}
ggplot(swallows.df.5, aes(Year, CID)) + 
  geom_point() + 
  geom_jitter() +
  xlab("Year") + 
  ylab("Clutch initiation date (May 1 = day 1)") + 
  facet_grid(. ~ Species)
```

Boxplot to see the same data another way. Looks like the both species are initiating clutches earlier in the 2006-16 period than they were in the 1960-72 period.
```{r}
ggplot(swallows.df.5, aes(Yr, CID)) + 
  stat_boxplot(geom="errorbar") + 
  geom_boxplot(outlier.shape=1) + 
  xlab("Period") + ylab("Clutch initiation date (May 1 = day 1)") + 
  facet_grid(. ~ Species)
```
   
**Q2 - Changes breeding performance. Look at % of the clutch that survived (Surv.Rate) in both species over time.**  

The boxplot and scatterplot are difficult to interpret alone and more informative when combined. It looks like survival is fairly consistent over time. Perhaps it has decreased slightly in Barn Swallows.
```{r chunk_name, warning=FALSE}
ggplot(swallows.df.5, aes(Yr, Surv.Rate)) + 
  stat_boxplot(geom="errorbar") + 
  geom_boxplot(outlier.shape=1) + 
  xlab("Period") + ylab("Survival") + 
  facet_grid(. ~ Species)  +   
  geom_jitter()
```




